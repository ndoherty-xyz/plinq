<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>chirp playground</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui,
          sans-serif;
        background: #111;
        color: #e0e0e0;
        padding: 24px;
        max-width: 960px;
        margin: 0 auto;
      }
      h1 {
        font-size: 24px;
        margin-bottom: 4px;
      }
      .subtitle {
        color: #888;
        margin-bottom: 24px;
        font-size: 14px;
      }
      h2 {
        font-size: 16px;
        margin-bottom: 12px;
        color: #aaa;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      /* preset buttons */
      .presets {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 32px;
      }
      .presets button {
        padding: 10px 20px;
        background: #222;
        color: #e0e0e0;
        border: 1px solid #333;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-family: inherit;
        transition: background 0.1s;
      }
      .presets button:hover {
        background: #2a2a2a;
        border-color: #555;
      }
      .presets button:active {
        background: #333;
      }
      .presets button.active {
        border-color: #6c9;
        background: #1a2a1a;
      }

      #themes button {
        background: #1a1a2a;
        border-color: #333366;
      }
      #themes button:hover {
        background: #252540;
        border-color: #4444aa;
      }
      #themes button.active {
        background: #1a1a3a;
        border-color: #6699ff;
        color: #99bbff;
      }

      /* editor */
      .editor {
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 24px;
        margin-bottom: 24px;
      }
      .layers {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .layer-card {
        background: #1a1a1a;
        border: 1px solid #2a2a2a;
        border-radius: 8px;
        padding: 16px;
      }
      .layer-card h3 {
        font-size: 13px;
        color: #888;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .layer-card h3 button {
        background: none;
        border: none;
        color: #666;
        cursor: pointer;
        font-size: 16px;
      }
      .layer-card h3 button:hover {
        color: #f66;
      }

      .field {
        margin-bottom: 10px;
      }
      .field label {
        display: block;
        font-size: 11px;
        color: #777;
        margin-bottom: 3px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .field input[type="range"] {
        width: 100%;
        accent-color: #6c9;
      }
      .field select,
      .field input[type="number"] {
        width: 100%;
        padding: 4px 6px;
        background: #222;
        color: #ddd;
        border: 1px solid #333;
        border-radius: 4px;
        font-size: 13px;
        font-family: inherit;
      }
      .range-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .range-row input[type="range"] {
        flex: 1;
      }
      .range-row .val {
        font-size: 12px;
        color: #999;
        min-width: 50px;
        text-align: right;
        font-variant-numeric: tabular-nums;
      }

      .config-panel {
        background: #1a1a1a;
        border: 1px solid #2a2a2a;
        border-radius: 8px;
        padding: 16px;
        display: flex;
        flex-direction: column;
      }
      .config-panel h3 {
        font-size: 13px;
        color: #888;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .config-panel pre {
        flex: 1;
        background: #111;
        border: 1px solid #222;
        border-radius: 4px;
        padding: 12px;
        font-size: 12px;
        color: #b0d0b0;
        overflow: auto;
        white-space: pre-wrap;
        word-break: break-all;
        font-family: "SF Mono", "Fira Code", "Cascadia Code", monospace;
      }
      .btn-sm {
        padding: 3px 10px;
        background: #222;
        color: #aaa;
        border: 1px solid #333;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        font-family: inherit;
      }
      .btn-sm:hover {
        background: #2a2a2a;
        border-color: #555;
      }
      .actions {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
      }
      .actions button {
        padding: 8px 16px;
        background: #1a2a1a;
        color: #6c9;
        border: 1px solid #3a5a3a;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        font-family: inherit;
      }
      .actions button:hover {
        background: #2a3a2a;
      }
      .copied {
        color: #6c9;
        font-size: 12px;
        opacity: 0;
        transition: opacity 0.2s;
      }
      .copied.show {
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <h1>plinq sound library</h1>
    <p class="subtitle">pick a theme, click a sound, tweak parameters</p>

    <h2>themes</h2>
    <div class="presets" id="themes"></div>

    <h2>sounds</h2>
    <div class="presets" id="presets"></div>

    <div class="actions">
      <button onclick="playCurrentConfig()">&#9654; play</button>
      <button onclick="addLayer()">+ add layer</button>
    </div>

    <div class="editor">
      <div class="layers" id="layers"></div>
      <div class="config-panel">
        <h3>
          config
          <span>
            <button class="btn-sm" onclick="copyConfig()">copy</button>
            <span class="copied" id="copied">copied!</span>
          </span>
        </h3>
        <pre id="config-output"></pre>
      </div>
    </div>

    <script type="module">
      import { play as playSound } from "plinq";

      // ============ THEMES ============

      const THEMES = {
        // ---- 8-BIT: Square waves, chiptune vibes ----
        "8bit": {
          click: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 800,
                  frequencyEnd: 600,
                },
                envelope: { attack: 0.001, decay: 0.04 },
                gain: 0.2,
              },
            ],
          },
          pop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 600,
                  frequencyEnd: 400,
                },
                envelope: { attack: 0.001, decay: 0.06 },
                gain: 0.25,
              },
            ],
          },
          toggle: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 523,
                },
                envelope: { attack: 0.001, decay: 0.05 },
                gain: 0.2,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 659,
                },
                envelope: { attack: 0.001, decay: 0.05 },
                gain: 0.2,
                delay: 0.05,
              },
            ],
          },
          tick: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 1200,
                },
                envelope: { attack: 0.001, decay: 0.02 },
                gain: 0.15,
              },
            ],
          },
          drop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 800,
                  frequencyEnd: 200,
                },
                envelope: { attack: 0.001, decay: 0.15 },
                gain: 0.25,
              },
            ],
          },
          success: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 523,
                },
                envelope: { attack: 0.001, decay: 0.12 },
                gain: 0.15,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 659,
                },
                envelope: { attack: 0.001, decay: 0.12 },
                gain: 0.15,
                delay: 0.08,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 784,
                },
                envelope: { attack: 0.001, decay: 0.15 },
                gain: 0.15,
                delay: 0.16,
              },
            ],
          },
          error: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 150,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.2,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 120,
                },
                envelope: { attack: 0.001, decay: 0.15 },
                gain: 0.2,
                delay: 0.1,
              },
            ],
          },
          warning: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 440,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.2,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "square",
                  frequency: 440,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.2,
                delay: 0.15,
              },
            ],
          },
          woosh: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "bandpass", frequency: 1100, Q: 0.2 },
                envelope: { attack: 0.08, decay: 0.35 },
                gain: 0.09,
              },
            ],
          },
        },

        // ---- MINIMAL: Ultra-subtle, barely there ----
        minimal: {
          click: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "highpass", frequency: 3000, Q: 0.5 },
                envelope: { attack: 0.001, decay: 0.02 },
                gain: 0.1,
              },
            ],
          },
          pop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 400,
                  frequencyEnd: 350,
                },
                envelope: { attack: 0.001, decay: 0.04 },
                gain: 0.15,
              },
            ],
          },
          toggle: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 600,
                },
                envelope: { attack: 0.001, decay: 0.03 },
                gain: 0.12,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 750,
                },
                envelope: { attack: 0.001, decay: 0.03 },
                gain: 0.12,
                delay: 0.03,
              },
            ],
          },
          tick: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "highpass", frequency: 6000, Q: 0.3 },
                envelope: { attack: 0.001, decay: 0.015 },
                gain: 0.08,
              },
            ],
          },
          drop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 500,
                  frequencyEnd: 300,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.15,
              },
            ],
          },
          success: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 600,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.1,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 800,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.1,
                delay: 0.03,
              },
            ],
          },
          error: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 200,
                },
                envelope: { attack: 0.001, decay: 0.08 },
                gain: 0.15,
              },
            ],
          },
          warning: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 350,
                },
                envelope: { attack: 0.001, decay: 0.08 },
                gain: 0.12,
              },
            ],
          },
          woosh: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "bandpass", frequency: 1800, Q: 0.1 },
                envelope: { attack: 0.06, decay: 0.3 },
                gain: 0.05,
              },
            ],
          },
        },

        // ---- SOFT: Warm, gentle, longer decays ----
        soft: {
          click: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 277,
                  frequencyEnd: 117,
                },
                filter: { type: "lowpass", frequency: 254, Q: 0.1 },
                envelope: { attack: 0.001, decay: 0.06 },
                gain: 0.1,
              },
            ],
          },
          pop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 557,
                  frequencyEnd: 398,
                },
                filter: { type: "lowpass", frequency: 347, Q: 0.1 },
                envelope: { attack: 0.001, decay: 0.19 },
                gain: 0.11,
              },
            ],
          },
          toggle: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 350,
                },
                filter: { type: "lowpass", frequency: 800, Q: 0.5 },
                envelope: { attack: 0.005, decay: 0.1 },
                gain: 0.2,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 440,
                },
                filter: { type: "lowpass", frequency: 800, Q: 0.5 },
                envelope: { attack: 0.005, decay: 0.1 },
                gain: 0.2,
                delay: 0.08,
              },
            ],
          },
          tick: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 500,
                },
                filter: { type: "lowpass", frequency: 1200, Q: 0.5 },
                envelope: { attack: 0.003, decay: 0.04 },
                gain: 0.12,
              },
            ],
          },
          drop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 450,
                  frequencyEnd: 180,
                },
                filter: { type: "lowpass", frequency: 600, Q: 0.7 },
                envelope: { attack: 0.01, decay: 0.3 },
                gain: 0.25,
              },
            ],
          },
          success: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 392,
                },
                filter: { type: "lowpass", frequency: 1000, Q: 0.5 },
                envelope: { attack: 0.01, decay: 0.35 },
                gain: 0.18,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 494,
                },
                filter: { type: "lowpass", frequency: 1000, Q: 0.5 },
                envelope: { attack: 0.01, decay: 0.35 },
                gain: 0.18,
                delay: 0.08,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 588,
                },
                filter: { type: "lowpass", frequency: 1000, Q: 0.5 },
                envelope: { attack: 0.01, decay: 0.4 },
                gain: 0.18,
                delay: 0.16,
              },
            ],
          },
          error: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 499,
                  frequencyEnd: 302,
                },
                envelope: { attack: 0.001, decay: 0.08 },
                gain: 0.11,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 316,
                  frequencyEnd: 84,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.09,
                delay: 0.11,
              },
            ],
          },
          warning: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 330,
                },
                filter: { type: "lowpass", frequency: 600, Q: 0.5 },
                envelope: { attack: 0.01, decay: 0.25 },
                gain: 0.22,
              },
            ],
          },
          woosh: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "lowpass", frequency: 460, Q: 13.7 },
                envelope: { attack: 0.059, decay: 0.22 },
                gain: 0.09,
              },
            ],
          },
        },

        // ---- CRISP: Clean, precise, modern ----
        crisp: {
          click: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "bandpass", frequency: 3000, Q: 2 },
                envelope: { attack: 0.001, decay: 0.03 },
                gain: 0.25,
              },
            ],
          },
          pop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 600,
                  frequencyEnd: 400,
                },
                envelope: { attack: 0.001, decay: 0.06 },
                gain: 0.3,
              },
            ],
          },
          toggle: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 500,
                },
                envelope: { attack: 0.001, decay: 0.04 },
                gain: 0.22,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 700,
                },
                envelope: { attack: 0.001, decay: 0.04 },
                gain: 0.22,
                delay: 0.04,
              },
            ],
          },
          tick: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "highpass", frequency: 5000, Q: 0.7 },
                envelope: { attack: 0.001, decay: 0.02 },
                gain: 0.15,
              },
            ],
          },
          drop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 700,
                  frequencyEnd: 250,
                },
                envelope: { attack: 0.001, decay: 0.15 },
                gain: 0.28,
              },
            ],
          },
          success: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 587,
                },
                envelope: { attack: 0.001, decay: 0.15 },
                gain: 0.18,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 740,
                },
                envelope: { attack: 0.001, decay: 0.15 },
                gain: 0.18,
                delay: 0.04,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 880,
                },
                envelope: { attack: 0.001, decay: 0.18 },
                gain: 0.18,
                delay: 0.08,
              },
            ],
          },
          error: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "triangle",
                  frequency: 200,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.22,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "triangle",
                  frequency: 220,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.22,
              },
            ],
          },
          warning: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "triangle",
                  frequency: 500,
                },
                envelope: { attack: 0.001, decay: 0.12 },
                gain: 0.25,
              },
            ],
          },
          woosh: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "bandpass", frequency: 900, Q: 0.15 },
                envelope: { attack: 0.06, decay: 0.32 },
                gain: 0.09,
              },
            ],
          },
        },

        // ---- BUBBLY: Playful, bouncy, high frequencies ----
        bubbly: {
          click: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 1200,
                  frequencyEnd: 800,
                },
                envelope: { attack: 0.001, decay: 0.04 },
                gain: 0.2,
              },
            ],
          },
          pop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 800,
                  frequencyEnd: 500,
                },
                envelope: { attack: 0.001, decay: 0.08 },
                gain: 0.3,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 1600,
                  frequencyEnd: 1000,
                },
                envelope: { attack: 0.001, decay: 0.06 },
                gain: 0.1,
              },
            ],
          },
          toggle: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 700,
                  frequencyEnd: 600,
                },
                envelope: { attack: 0.001, decay: 0.05 },
                gain: 0.22,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 900,
                  frequencyEnd: 800,
                },
                envelope: { attack: 0.001, decay: 0.05 },
                gain: 0.22,
                delay: 0.05,
              },
            ],
          },
          tick: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 1400,
                  frequencyEnd: 1200,
                },
                envelope: { attack: 0.001, decay: 0.025 },
                gain: 0.15,
              },
            ],
          },
          drop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 1000,
                  frequencyEnd: 300,
                },
                envelope: { attack: 0.001, decay: 0.2 },
                gain: 0.28,
              },
            ],
          },
          success: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 700,
                },
                envelope: { attack: 0.001, decay: 0.12 },
                gain: 0.18,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 900,
                },
                envelope: { attack: 0.001, decay: 0.12 },
                gain: 0.18,
                delay: 0.06,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 1100,
                },
                envelope: { attack: 0.001, decay: 0.15 },
                gain: 0.18,
                delay: 0.12,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 1400,
                },
                envelope: { attack: 0.001, decay: 0.18 },
                gain: 0.15,
                delay: 0.18,
              },
            ],
          },
          error: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 400,
                  frequencyEnd: 300,
                },
                envelope: { attack: 0.001, decay: 0.08 },
                gain: 0.2,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 350,
                  frequencyEnd: 250,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.2,
                delay: 0.08,
              },
            ],
          },
          warning: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 600,
                  frequencyEnd: 500,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.25,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 600,
                  frequencyEnd: 500,
                },
                envelope: { attack: 0.001, decay: 0.1 },
                gain: 0.25,
                delay: 0.12,
              },
            ],
          },
          woosh: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "lowpass", frequency: 1375, Q: 0.1 },
                envelope: { attack: 0.108, decay: 0.43 },
                gain: 0.1,
              },
            ],
          },
        },

        // ---- LOFI: Warm, muffled, cozy ----
        lofi: {
          click: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "lowpass", frequency: 800, Q: 0.8 },
                envelope: { attack: 0.003, decay: 0.06 },
                gain: 0.2,
              },
            ],
          },
          pop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 380,
                  frequencyEnd: 260,
                },
                filter: { type: "lowpass", frequency: 600, Q: 0.5 },
                envelope: { attack: 0.005, decay: 0.1 },
                gain: 0.28,
              },
            ],
          },
          toggle: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 320,
                },
                filter: { type: "lowpass", frequency: 700, Q: 0.5 },
                envelope: { attack: 0.005, decay: 0.08 },
                gain: 0.22,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 400,
                },
                filter: { type: "lowpass", frequency: 700, Q: 0.5 },
                envelope: { attack: 0.005, decay: 0.08 },
                gain: 0.22,
                delay: 0.08,
              },
            ],
          },
          tick: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "bandpass", frequency: 1200, Q: 1 },
                envelope: { attack: 0.002, decay: 0.04 },
                gain: 0.12,
              },
            ],
          },
          drop: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 450,
                  frequencyEnd: 150,
                },
                filter: { type: "lowpass", frequency: 500, Q: 0.7 },
                envelope: { attack: 0.005, decay: 0.25 },
                gain: 0.25,
              },
            ],
          },
          success: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 350,
                },
                filter: { type: "lowpass", frequency: 800, Q: 0.5 },
                envelope: { attack: 0.01, decay: 0.3 },
                gain: 0.18,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 440,
                },
                filter: { type: "lowpass", frequency: 800, Q: 0.5 },
                envelope: { attack: 0.01, decay: 0.3 },
                gain: 0.18,
                delay: 0.1,
              },
              {
                source: {
                  type: "oscillator",
                  waveform: "sine",
                  frequency: 523,
                },
                filter: { type: "lowpass", frequency: 800, Q: 0.5 },
                envelope: { attack: 0.01, decay: 0.35 },
                gain: 0.18,
                delay: 0.2,
              },
            ],
          },
          error: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "triangle",
                  frequency: 150,
                  frequencyEnd: 100,
                },
                filter: { type: "lowpass", frequency: 400, Q: 0.5 },
                envelope: { attack: 0.01, decay: 0.2 },
                gain: 0.25,
              },
            ],
          },
          warning: {
            layers: [
              {
                source: {
                  type: "oscillator",
                  waveform: "triangle",
                  frequency: 280,
                },
                filter: { type: "lowpass", frequency: 500, Q: 0.5 },
                envelope: { attack: 0.008, decay: 0.2 },
                gain: 0.22,
              },
            ],
          },
          woosh: {
            layers: [
              {
                source: { type: "noise" },
                filter: { type: "bandpass", frequency: 600, Q: 0.8 },
                envelope: { attack: 0.043, decay: 0.28 },
                gain: 0.07,
              },
            ],
          },
        },
      };

      // ============ STATE ============

      let currentTheme = "8bit";
      let currentConfig = JSON.parse(
        JSON.stringify(THEMES[currentTheme].click)
      );
      let activePreset = "click";

      // ============ UI ============

      const WAVEFORMS = ["sine", "triangle", "square", "sawtooth"];
      const FILTER_TYPES = [
        "lowpass",
        "highpass",
        "bandpass",
        "notch",
        "allpass",
        "peaking",
        "lowshelf",
        "highshelf",
      ];
      const SOURCE_TYPES = ["oscillator", "noise"];

      function renderThemes() {
        const el = document.getElementById("themes");
        el.innerHTML = "";
        for (const name of Object.keys(THEMES)) {
          const btn = document.createElement("button");
          btn.textContent = name;
          if (name === currentTheme) btn.classList.add("active");
          btn.onclick = () => {
            currentTheme = name;
            currentConfig = JSON.parse(
              JSON.stringify(THEMES[currentTheme][activePreset])
            );
            render();
            playSound(currentConfig);
          };
          el.appendChild(btn);
        }
      }

      function renderPresets() {
        const el = document.getElementById("presets");
        el.innerHTML = "";
        const themePresets = THEMES[currentTheme];
        for (const name of Object.keys(themePresets)) {
          const btn = document.createElement("button");
          btn.textContent = name;
          if (name === activePreset) btn.classList.add("active");
          btn.onclick = () => {
            activePreset = name;
            currentConfig = JSON.parse(JSON.stringify(themePresets[name]));
            render();
            playSound(currentConfig);
          };
          el.appendChild(btn);
        }
      }

      function makeRangeField(label, value, min, max, step, onChange) {
        const div = document.createElement("div");
        div.className = "field";
        const lbl = document.createElement("label");
        lbl.textContent = label;
        div.appendChild(lbl);
        const row = document.createElement("div");
        row.className = "range-row";
        const input = document.createElement("input");
        input.type = "range";
        input.min = min;
        input.max = max;
        input.step = step;
        input.value = value;
        const val = document.createElement("span");
        val.className = "val";
        val.textContent = Number(value).toFixed(step < 1 ? 3 : 0);
        input.oninput = () => {
          const v = parseFloat(input.value);
          val.textContent = v.toFixed(step < 1 ? 3 : 0);
          onChange(v);
          updateConfigOutput();
        };
        row.appendChild(input);
        row.appendChild(val);
        div.appendChild(row);
        return div;
      }

      function makeSelectField(label, value, options, onChange) {
        const div = document.createElement("div");
        div.className = "field";
        const lbl = document.createElement("label");
        lbl.textContent = label;
        div.appendChild(lbl);
        const sel = document.createElement("select");
        for (const opt of options) {
          const o = document.createElement("option");
          o.value = opt;
          o.textContent = opt;
          if (opt === value) o.selected = true;
          sel.appendChild(o);
        }
        sel.onchange = () => {
          onChange(sel.value);
          updateConfigOutput();
        };
        div.appendChild(sel);
        return div;
      }

      function renderLayer(layer, index) {
        const card = document.createElement("div");
        card.className = "layer-card";

        const h3 = document.createElement("h3");
        h3.innerHTML = `Layer ${index + 1} `;
        const del = document.createElement("button");
        del.textContent = "Ã—";
        del.onclick = () => {
          currentConfig.layers.splice(index, 1);
          render();
        };
        h3.appendChild(del);
        card.appendChild(h3);

        // source type
        card.appendChild(
          makeSelectField("source", layer.source.type, SOURCE_TYPES, (v) => {
            if (v === "oscillator") {
              layer.source = {
                type: "oscillator",
                waveform: "sine",
                frequency: 440,
              };
            } else {
              layer.source = { type: "noise" };
            }
            render();
          })
        );

        if (layer.source.type === "oscillator") {
          card.appendChild(
            makeSelectField(
              "waveform",
              layer.source.waveform,
              WAVEFORMS,
              (v) => {
                layer.source.waveform = v;
              }
            )
          );
          card.appendChild(
            makeRangeField(
              "frequency",
              layer.source.frequency,
              20,
              8000,
              1,
              (v) => {
                layer.source.frequency = v;
              }
            )
          );
          card.appendChild(
            makeRangeField(
              "frequencyEnd",
              layer.source.frequencyEnd || 0,
              0,
              8000,
              1,
              (v) => {
                layer.source.frequencyEnd = v || undefined;
              }
            )
          );
        }

        // filter toggle
        const hasFilter = !!layer.filter;
        card.appendChild(
          makeSelectField(
            "filter",
            hasFilter ? layer.filter.type : "none",
            ["none", ...FILTER_TYPES],
            (v) => {
              if (v === "none") {
                delete layer.filter;
              } else {
                layer.filter = layer.filter || {
                  type: v,
                  frequency: 1000,
                  Q: 1,
                };
                layer.filter.type = v;
              }
              render();
            }
          )
        );

        if (layer.filter) {
          card.appendChild(
            makeRangeField(
              "filter freq",
              layer.filter.frequency,
              20,
              16000,
              1,
              (v) => {
                layer.filter.frequency = v;
              }
            )
          );
          card.appendChild(
            makeRangeField(
              "filter Q",
              layer.filter.Q ?? 1,
              0.1,
              20,
              0.1,
              (v) => {
                layer.filter.Q = v;
              }
            )
          );
        }

        // envelope
        card.appendChild(
          makeRangeField(
            "attack",
            layer.envelope.attack,
            0.001,
            0.5,
            0.001,
            (v) => {
              layer.envelope.attack = v;
            }
          )
        );
        card.appendChild(
          makeRangeField("decay", layer.envelope.decay, 0.01, 2, 0.01, (v) => {
            layer.envelope.decay = v;
          })
        );
        card.appendChild(
          makeRangeField("gain", layer.gain, 0, 1, 0.01, (v) => {
            layer.gain = v;
          })
        );
        card.appendChild(
          makeRangeField("delay", layer.delay || 0, 0, 1, 0.01, (v) => {
            layer.delay = v || undefined;
          })
        );

        return card;
      }

      function renderLayers() {
        const el = document.getElementById("layers");
        el.innerHTML = "";
        currentConfig.layers.forEach((layer, i) => {
          el.appendChild(renderLayer(layer, i));
        });
      }

      function updateConfigOutput() {
        // strip undefined-ish values for clean output
        const clean = JSON.parse(
          JSON.stringify(currentConfig, (k, v) => {
            if (
              v === undefined ||
              (v === 0 && (k === "frequencyEnd" || k === "delay"))
            )
              return undefined;
            return v;
          })
        );
        document.getElementById("config-output").textContent = JSON.stringify(
          clean,
          null,
          2
        );
      }

      function render() {
        renderThemes();
        renderPresets();
        renderLayers();
        updateConfigOutput();
      }

      // ============ ACTIONS ============

      function playCurrentConfig() {
        playSound(currentConfig);
      }

      function addLayer() {
        currentConfig.layers.push({
          source: { type: "oscillator", waveform: "sine", frequency: 440 },
          envelope: { attack: 0.001, decay: 0.1 },
          gain: 0.25,
        });
        render();
      }

      function copyConfig() {
        const clean = JSON.parse(
          JSON.stringify(currentConfig, (k, v) => {
            if (
              v === undefined ||
              (v === 0 && (k === "frequencyEnd" || k === "delay"))
            )
              return undefined;
            return v;
          })
        );
        const text = `const config: SoundConfig = ${JSON.stringify(
          clean,
          null,
          2
        )}`;
        navigator.clipboard.writeText(text).then(() => {
          const el = document.getElementById("copied");
          el.classList.add("show");
          setTimeout(() => el.classList.remove("show"), 1500);
        });
      }

      // Expose actions to inline onclick handlers (ES modules don't pollute global scope)
      window.playCurrentConfig = playCurrentConfig;
      window.addLayer = addLayer;
      window.copyConfig = copyConfig;

      // boot
      render();
    </script>
  </body>
</html>
